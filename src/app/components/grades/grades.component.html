<div class="container" [formGroup]="gradesForm">
  <div class="header">
    <h1>Lançamento de Notas</h1>
  </div>

  <div class="filters">
    <div class="filter-item">
      <mat-form-field appearance="fill">
        <mat-label>Ano Letivo</mat-label>
        <mat-select formControlName="year">
          @for (year of years; track $index) {
            <mat-option [value]="year">{{ year }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-item">
      <mat-form-field appearance="fill">
        <mat-label>Turma</mat-label>
        <mat-select formControlName="class">
          @for (class of classes; track $index) {
            <mat-option [value]="class">{{ class }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-item">
      <mat-form-field appearance="fill">
        <mat-label>Matéria</mat-label>
        <mat-select formControlName="subject">
          @for (subject of subjects; track $index) {
            <mat-option [value]="subject">{{ subject }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="onFilterChange()">
        Atualizar Filtros
      </button>
    </div>
  </div>

  <div class="table-container">
    <table mat-table [dataSource]="filteredStudents" class="mat-elevation-z8">
      <ng-container matColumnDef="student">
        <th mat-header-cell *matHeaderCellDef>Aluno</th>
        <td mat-cell *matCellDef="let student">{{ student.name }}</td>
      </ng-container>

      <ng-container matColumnDef="grade">
        <th mat-header-cell *matHeaderCellDef>Nota</th>
        <td mat-cell *matCellDef="let student">
          <mat-form-field appearance="fill">
            <input
              matInput
              type="number"
              [formControlName]="'grade_' + student.id"
              placeholder="Nota"
            />
            @if (gradesForm.get('grade_' + student.id)?.invalid) {
              <mat-error>
                Nota deve ser entre 0 e 10
              </mat-error>
            }
          </mat-form-field>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['student', 'grade']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['student', 'grade']"></tr>
    </table>
  </div>

  <div class="actions">
    <button
      mat-raised-button
      color="primary"
      [disabled]="gradesForm.invalid"
      (click)="saveGrades()"
    >
      Salvar Notas
    </button>
  </div>
</div>
